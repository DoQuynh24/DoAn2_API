<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SULLY & BAG | Việt Nam</title>
    <link rel="stylesheet" href="./style_admin.css">
    <link rel="icon" href="images/logo.png">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="angular/global.js"></script>
    <script src="angular/script.js"></script>
    <script src="angular/admin.js"></script>
    <script src="angular/admin_user.js"></script>
    <script src="angular/admin_bills.js"></script>
    <script src="angular/admin_product.js"></script>
    <script src="angular/admin_home.js"> </script>
    <script src="angular/admin_orders.js"></script>
    <script src="angular/user_login.js"></script>
   
    <script src="js/admin.js" defer></script>
    
     <!-- Bootstrap 5.3.3 -->
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>
<body ng-app="AppAdmin">
    <div id="main">
        <div id="header">
            <div id="name">
                <p class="name">Sully & Bag</p>
            </div>
            <div id="search">
                <img class="menu" src="images/menu.png"/>
                <div id="text">
                    <span>Home</span>
                    <span style="margin-left: 40px;">About</span>
                    <span style="margin-left: 40px;">Project</span>
                    <span style="margin-left: 40px;">Support</span>
                </div>
            </div>
            <div id="avt">
                <img style="width:23px; height:23px;margin-top: 20px; margin-right: 20px;" src="images/letter.png"/>
                <img style="width:25px; height:25px;margin-top: 20px; margin-right: 20px;" src="images/ring.png"/>
                <img style="width:25px; height:25px;margin-top: 20px; margin-right: 20px;" src="images/chat.png"/>
                <img class="avt" src="images/avt.jpg"/>
                <p style="text-align: center; font-size: 17px; margin-top: 20px; margin-left: 10px;">Đỗ Quỳnh ▼</p>
                <img style="width:25px; height:25px; margin-top: 20px; margin-left: 20px;" src="images/setting.png"/>
            </div>
        </div>
        <div id="content">
            <div id="content-left" ng-controller="tab">
                <button class="button" data-tab="home"><img class="icon" src="images/home.png"/>Trang chủ</button>
                <button class="button" data-tab="products" ><img class="icon" src="images/tui.png"/>Sản phẩm</button>
                <button class="button" data-tab="bills"><img class="icon" src="images/bill.png"/>Hóa đơn</button>
                <button class="button" data-tab="orders"><img class="icon" src="images/staff.png"/>Nhập hàng</button>
                <button class="button" data-tab="notifications"><img class="icon" src="images/thongbao.png"/>Thông báo</button>
                <button class="button" data-tab="store"><img class="icon" src="images/shopp.png"/>Cửa hàng</button>
                <button class="button" data-tab="user" ><img class="icon" src="images/shopp.png"/>Người dùng</button>
            </div>
        
            <div id="content-right">
                <!-- Nội dung Tab Trang Chủ -->
                <div id="home" class="tab-content active" ng-controller="homeCtrl" >
                    <div class="stats">
                        <div class="stat-item">
                            <h3>Tổng sản phẩm</h3>
                            <p>{{ listProduct.length }}</p>
                        </div>
                        <div class="stat-item">
                            <h3>Khách hàng</h3>
                            <p>{{ listUser.length }}</p>
                        </div>
                        <div class="stat-item">
                            <h3> Tổng Hóa đơn</h3>
                            <p>{{ totalHoaDon  }}</p>
                        </div>
                        <div class="stat-item">
                            <h3> Đang xử lý</h3>
                            <p>{{ totalDangXuLy }}</p>
                        </div>
                        <div class="stat-item">
                            <h3> Chờ giao hàng</h3>
                            <p>{{ totalChoGiaoHang}}</p>
                        </div>
                    </div>
                     <!-- Thêm biểu đồ -->
                        <div style="width: 90%; margin: 35px auto;">
                            <canvas id="hoaDonChart"></canvas>
                        </div>
                </div>
            
                <!-- Nội dung Tab Sản phẩm -->
                <div id="products" class="tab-content" ng-controller="productCtrl">
                    <div class="search-container-sanpham">
                        <div class="search-icon">
                            <img src="images/search.png" alt="Search" />
                        </div>
                        <input style="background-color: #CCC; font-size: 13px;" type="text" ng-model="searchQuery" placeholder="Bạn có thể tìm kiếm theo ID đơn hàng hoặc Tên sản phẩm" 
                            ng-change="search('hoadons', searchQuery)" class="form-control" 
                        />
                    </div>    
                    <div >
                        <div class="product-header d-flex justify-content-between align-items-center mb-3">
                            <div class="filters d-flex gap-3">
                                <div>
                                    <select id="filterCategory" class="form-select"  ng-model="selectedCategory" ng-change="filterProducts()"> 
                                        <option value=""  >Lọc sản phẩm theo danh mục</option>
                                        <option ng-repeat="category in categories" value="{{ category.maDanhMuc }}">
                                            {{ category.tenDanhMuc }}
                                        </option>
                                    </select> 
                                </div>
                                <button class="icon-pencil" ng-click="editCategory(category)">✏️</button> 
                                <button class="btn-add" data-bs-toggle="modal" data-bs-target="#CategoryModal"> ➕︎ </button>
                                <!-- Modal Thêm Danh Mục -->
                                <div class="modal fade" id="CategoryModal" tabindex="-1" aria-labelledby="CategoryModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="CategoryModalLabel">
                                                    {{ isEditCategoryMode ? 'Cập nhật danh mục' : 'Thêm Danh Mục' }}
                                                </h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form ng-submit="saveCategory()" enctype="multipart/form-data">
                                                    <div class="mb-3">
                                                        <label for="categoryID" class="form-label">Mã danh mục</label>
                                                        <input type="text" class="form-control" id="categoryID" ng-model="newCategory.maDanhMuc" required>
                                                        <label for="categoryName" class="form-label">Tên danh mục</label>
                                                        <input type="text" class="form-control" id="categoryName" ng-model="newCategory.tenDanhMuc" required>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                                <button ng-click="saveCategory()" type="button" class="btn btn-primary">
                                                    {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                     
                                <!-- Lọc theo màu sắc -->
                                <div>
                                    <select id="filterColor" class="form-select" ng-model="selectedColor" ng-change="filterProducts()">
                                        <option value="">Lọc sản phẩm theo màu sắc</option>
                                        <option ng-repeat="color in colors" value="{{color.maMau}}">
                                            {{ color.tenMau }}
                                        </option>
                                    </select>
                                </div>                           
                                <button class="btn-add" data-bs-toggle="modal" data-bs-target="#addColorModal"> ➕︎ </button>
    
                                <!-- Modal Thêm Màu Sắc -->
                                <div class="modal fade" id="addColorModal" tabindex="-1" aria-labelledby="addColorModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="addColorModalLabel">Thêm Màu Sắc Mới</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form>
                                                    <div class="mb-3">
                                                        <label for="colorName" class="form-label">Tên Màu</label>
                                                        <input type="text" class="form-control" id="colorName" ng-model="newColor.tenMau" required>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                                <button type="button" class="btn btn-primary" ng-click="addColor()">Thêm</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
    
                                <!-- Lọc theo size -->
                                <div>
                                    <select id="filterSize" class="form-select" ng-model="selectedSize" ng-change="filterProducts()">
                                        <option value="">Lọc sản phẩm theo size</option>
                                        <option ng-repeat="size in sizes" value="{{size.maSize}}">
                                            {{ size.maSize }}
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <button type="button" style="float:right; border:none;background-color: #FFF;" data-bs-toggle="modal" data-bs-target="#productModal" ng-click="clearFormProduct()"> <image class="add" src="images/addProduct.png" /></button>   
                        </div>
                      
                    </div>
    
                    <table class="product-table" >
                        <thead>
                            <tr>
                                <th>ID </th>
                                <th>Loại Túi</th>
                                <th>Tên Sản Phẩm</th>
                                <th>Giá Bán</th>
                                <th>Màu sắc</th>
                                <th>Size</th>
                                <th>Tồn kho</th>
                                <th>Hình ảnh</th>
                                <th>Hành động</th>
    
                            </tr>
                        </thead>
                        <tbody >
                            <tr ng-repeat="p in paginatedProducts()">
                                <td>{{p.maSp}}</td>
                                <td>{{p.maDanhMuc}}</td>
                                <td>{{p.tenSp}}</td>
                                <td>{{p.giaBan  | number: 0}}</td>
                                <td>{{p.tenMau}}</td>
                                <td>{{p.maSize}}</td>
                                <td>{{p.tonKho}}</td>
                                <td>
                                    <img id="anh-tui-sach-{{p.maSp}}" ng-src="{{'https://localhost:44366/api/TuiXach/get-img/' + p.hinhAnh}}" alt="Ảnh sản phẩm" style="width: 70px; height:60px">
                                </td>
                                                  
                                <td>
                                    <button class="edit-btn" ng-click="editProduct(p)" data-bs-toggle="modal" data-bs-target="#productModal">Sửa</button>
                                    <button class="delete-btn" ng-click="deleteProduct(p.maSanPham)">Xóa</button>
                                </td> 
                            </tr>
                        </tbody>
                    </table>
                     <!-- Phân trang -->
                     <div class="pagination">
                        <button ng-repeat="page in [].constructor(totalPages()) track by $index"
                                ng-class="{'active': currentPage === $index + 1}"
                                ng-click="setPage($index + 1)">
                            {{ $index + 1 }}
                        </button>
                    </div>
                    <!--Modal Thếm/Sửa Sản phảm-->
                    <div class="modal fade modal-lg" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h1 class="modal-title fs-5" id="productModalLabel">
                                {{ isEditMode ? 'Cập nhật Sản Phẩm' : 'Thêm Sản Phẩm' }}
                            </h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form ng-submit="saveProduct()" enctype="multipart/form-data">
                                    <div class="row mb-3">
                                        <!-- Mã Danh Mục -->
                                        <div class="col-md-6">
                                            <label for="maDanhMuc" class="form-label">Mã Danh Mục:</label>
                                            <input type="text" id="maDanhMuc" ng-model="newProduct.maDanhMuc" class="form-control" required>
                                        </div>
                                        <!-- Mã Sản Phẩm -->
                                        <div class="col-md-6">
                                            <label for="maSp" class="form-label">Mã Sản Phẩm:</label>
                                            <input type="text" id="maSp" ng-model="newProduct.maSp" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <!-- Tên Sản Phẩm -->
                                        <div class="col-md-6">
                                            <label for="tenSp" class="form-label">Tên Sản Phẩm:</label>
                                            <input type="text" id="tenSp" ng-model="newProduct.tenSp" class="form-control" required>
                                        </div>
                                        <!-- Giá Bán -->
                                        <div class="col-md-6">
                                            <label for="giaBan" class="form-label">Giá Bán:</label>
                                            <input type="number" id="giaBan" ng-model="newProduct.giaBan" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <!-- Khuyến Mãi -->
                                        <div class="col-md-6">
                                            <label for="khuyenMai" class="form-label">Khuyến Mãi:</label>
                                            <input type="number" id="khuyenMai" ng-model="newProduct.khuyenMai" class="form-control">
                                        </div>
                                        <!-- Tồn Kho -->
                                        <div class="col-md-6">
                                            <label for="tonKho" class="form-label">Tồn Kho:</label>
                                            <input type="number" id="tonKho" ng-model="newProduct.tonKho" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <!-- Màu Sắc -->
                                        <div class="col-md-6">
                                            <label for="mauSac" class="form-label">Màu Sắc:</label>
                                            <select class="form-control" id="color" ng-model="newProduct.tenMau" required>
                                                <option ng-repeat="color in colors" value="{{color.tenMau}}">{{color.tenMau}}</option>
                                            </select>
                                        </div>
                                        <!-- Size -->
                                        <div class="col-md-6">
                                            <label for="size" class="form-label">Chọn Size:</label>
                                            <select class="form-control" id="size" ng-model="newProduct.maSize" required>
                                                <option ng-repeat="size in sizes" value="{{size.maSize}}">{{size.maSize}}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <!-- Mô Tả -->
                                        <div class="col-12">
                                            <label for="moTa" class="form-label">Mô Tả:</label>
                                            <textarea id="moTa" ng-model="newProduct.moTa" class="form-control"></textarea>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <!-- Hình Ảnh -->
                                        <div class="col-12">
                                            <label for="hinhAnh" class="form-label">Hình Ảnh:</label>
                                            <img ng-src="{{newProduct.imageUrl || getImageUrl(newProduct.hinhAnh)}}" alt="Ảnh sản phẩm"style="width:50px; height:50px" />
                                            <input type="file" ngf-select="onFileChange($file)" />
                                        </div>
                                    </div>   
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                <button ng-click="saveProduct()" type="button" class="btn btn-primary">
                                    {{ isEditProductMode ? 'Cập nhật' : 'Thêm mới' }}
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            
                <!-- Nội dung Tab Hóa đơn -->
                <div id="bills" class="tab-content" ng-controller="billsCtrl">
                    <div class="header-hoadon">
                        <div id="menu">
                            <div class="menu-item" ng-class="{'active': selectedStatus === 'Tất cả'}" ng-click="LoadHoaDon('Tất cả')">Tất cả</div>
                            <div class="menu-item" ng-class="{'active': selectedStatus === 'Đang xử lý'}" ng-click="LoadHoaDon('Đang xử lý')">Đang xử lý</div>
                            <div class="menu-item" ng-class="{'active': selectedStatus === 'Đang lấy hàng'}" ng-click="LoadHoaDon('Đang lấy hàng')">Đang lấy hàng</div>
                            <div class="menu-item" ng-class="{'active': selectedStatus === 'Chờ giao hàng'}" ng-click="LoadHoaDon('Chờ giao hàng')">Chờ giao hàng</div>
                            <div class="menu-item" ng-class="{'active': selectedStatus === 'Hoàn thành'}" ng-click="LoadHoaDon('Hoàn thành')">Hoàn thành</div>
                            <div class="menu-item" ng-class="{'active': selectedStatus === 'Đã hủy'}" ng-click="LoadHoaDon('Đã hủy')">Đã hủy</div>
                        </div>
                        
                        <!-- Thanh tìm kiếm -->
                        
                        <div class="search-container-hoadon">
                            <div class="search-icon">
                                <img src="images/search.png" alt="Search" />
                            </div>
                            <input style="background-color: #CCC; font-size: 13px;"   type="text" ng-model="searchQuery" placeholder="Bạn có thể tìm kiếm theo ID đơn hàng hoặc Tên sản phẩm" 
                                ng-change="search('hoadons', searchQuery)" class="form-control" 
                            />
                        </div>
                    </div> 
                    <div>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>MaHD</th>
                                    <th>PerID</th>
                                    <th>Ngày đặt hàng</th>
                                    <th>Trạng thái</th>
                                    <th>Ngày nhận hàng</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="h in paginatedHoaDon()">
                                    <td>{{h.maHD}}</td>
                                    <td>{{h.perID}}</td>
                                    <td>{{h.ngayDatHang | date:'dd/MM/yyyy'}}</td>
                                    <td ng-class="{
                                        'trang-thai-dang-xu-ly': h.trangThai === 'Đang xử lý',
                                        'trang-thai-dang-lay-hang': h.trangThai === 'Đang lấy hàng',
                                        'trang-thai-cho-giao-hang': h.trangThai === 'Chờ giao hàng',
                                        'trang-thai-hoan-thanh': h.trangThai === 'Hoàn thành',
                                        'trang-thai-da-huy': h.trangThai === 'Đã hủy'
                                    }">
                                        {{ h.trangThai }}
                                    </td>
                                    
                                    <td ng-if="h.trangThai === 'Hoàn thành'">{{ h.ngayNhanHang | date:'dd/MM/yyyy' }}</td>
                                    <td ng-if="h.trangThai !== 'Hoàn thành'">--</td>

                                    <td>
                                        <button class="see-btn-hoadon" ng-click="LoadlistCTHD(h)">
                                            <img src="images/see.png" alt="" style="width: 23px; height: 23px;"> 
                                        </button>
                                        <button class="delete-btn-hoadon" ng-click="deleteHoaDon(h.maHD)">
                                            <img src="images/delete.png" alt="Xóa" style="width: 23px; height: 23px;"> 
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div>
                            <p>Tổng tiền các hóa đơn hoàn thành: {{ totalCompletedBills | number }} ₫</p>
                        </div>
                         <!-- Phân trang -->
                        <div class="pagination">
                            <button ng-repeat="page in [].constructor(totalPages()) track by $index"
                                    ng-class="{'active': currentPage === $index + 1}"
                                    ng-click="setPage($index + 1)">
                                {{ $index + 1 }}
                            </button>
                        </div>
                        <!-- <label style="text-align: center; margin-top: 10px;">{{ filteredHoaDon.length }} Hóa Đơn</label>
                        <p ng-if="listHoaDon.length === 0">Không có hóa đơn nào.</p> -->
                    </div>
                    <!-- Modal hiển thị hóa đơn -->
                    <div class="modal fade" id="billModal" tabindex="-1" aria-labelledby="billModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="billModalLabel">Thông tin Hóa Đơn</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row mb-2">
                                        <div class="col-md-5">
                                            <p><b>Mã Hóa Đơn:</b> {{selectedBill.maHD }}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><b>Ngày đặt hàng:</b> {{ selectedBill.ngayDatHang }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-md-5">
                                            <p><b>Khách hàng:</b> {{ selectedBill.perID }}
                                        </div>
                                        <div class="col-md-7">
                                            <p><b>Họ và Tên:</b> {{ selectedBill.hoTen }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-md-5">
                                            <p><b>Số điện thoại:</b> {{ selectedBill.sdt }}</p>
                                        </div>
                                        <div class="col-md-7">
                                            <p><b>Địa Chỉ:</b> {{ selectedBill.diaChi }}</p>
                                        </div>
                                       
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-md-5" ng-if="selectedBill.trangThai === 'Hoàn thành'">
                                            <p><b>Ngày nhận hàng:</b> {{ selectedBill.ngayNhanHang | date:'dd/MM/yyyy' }}</p>
                                        </div>
                                        <div class="col-md-5" ng-if="selectedBill.trangThai !== 'Hoàn thành'">
                                            <p><b>Ngày nhận hàng:</b>--</p>
                                        </div>
                                        <div class="col-md-7">
                                            <b>Trạng thái đơn hàng:</b>
                                            <select ng-model="selectedBill.trangThai "ng-disabled="selectedBill.trangThai === 'Hoàn thành'" >
                                                <option value="Đang xử lý">Đang xử lý</option>
                                                <option value="Đang lấy hàng">Đang lấy hàng</option>
                                                <option value="Chờ giao hàng">Chờ giao hàng</option>
                                                <option value="Hoàn thành">Hoàn thành</option>
                                                <option value="Đã hủy">Đã hủy</option>
                                            </select>
                                          
                                        </div>
                                    </div>
                                
                                    <!-- Bảng chi tiết hóa đơn -->
                                    
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Tên sản phẩm</th>
                                                <th>Màu sắc</th>
                                                <th>Size</th>
                                                <th>Số lượng</th>
                                                <th>Giá bán</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="ct in listChiTiet">
                                                <td>{{ ct.tenSp }}</td>
                                                <td>{{ ct.tenMau }}</td>
                                                <td>{{ ct.maSize }}</td>
                                                <td>{{ ct.soLuong }}</td>
                                                <td>{{ ct.giaBan | number: 0}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p style="margin-top: 15px;"  ng-repeat="ct in listChiTiet">Ghi chú: {{ ct.ghiChu }}</p>
                                    <div style="float:right;">
                                        <lable>Tổng tiền hàng: ₫{{ tongTienHang | number }}</lable>
                                        <p>Phí vận chuyển: ₫{{ phiVanChuyen | number }}</p>
                                        <p style="color:brown; font-weight: bold;">Thành tiền: ₫{{ thanhTien | number }}</p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button ng-click="updateBill()" type="button" class="btn btn-primary">
                                        Cập nhật
                                    </button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                </div>
                            </div>
                        </div>
                    </div>
               
                </div>    
                <!-- Nội dung Tab Đơn hàng nhập -->
                <div id="orders" class="tab-content" ng-controller="ordersCtrl">
                    <div class="header">
                        <h3 style="display: inline-block;">Đơn Hàng Nhập</h3>
                        <!-- Thanh tìm kiếm -->
                     
                        <div class="search-container-hoadon">
                            <div class="search-icon">
                                <img src="images/search.png" alt="Search" />
                            </div>
                            <input style="background-color: #CCC; font-size: 13px;" type="text" ng-model="searchQuery" placeholder="Bạn có thể tìm kiếm theo ID đơn hàng nhập hoặc Tên sản phẩm" 
                                ng-change="search('hoadons', searchQuery)" class="form-control" 
                            />
                        </div>    
                        <button type="button" style="float:right; border:none;background-color: #FFF" data-bs-toggle="modal" data-bs-target="#orderModal" ng-click="clearForm()">
                           <image class="add" src="images/addBills.png"/>
                        </button>
                    </div>  
        
                    <div>
                        <table border="1">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tên Nhà Cung Cấp</th>
                                    <th>Ngày Nhập</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="order in listOrder">
                                    <td>{{order.maDHN}}</td>
                                    <td>{{order.tenNCC}}</td>
                                    <td>{{order.ngayNhap  | date:'dd/MM/yyyy'}}</td>
                                    <td>
                                        <button class="see-btn" ng-click="LoadlistCTDHN(order)" data-bs-toggle="modal" data-bs-target="#orderModal">
                                            <img src="images/see.png" alt="Xem" style="width: 23px; height: 23px;"> 
                                        </button>
                                        <button class="delete-btn" ng-click="deleteOrder(order.maNCC)">
                                            <img src="images/delete.png" alt="Xóa" style="width: 23px; height: 23px;"> 
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
            
                        <lable style=" margin-top: 10px;"> {{ listOrder.length }}<a> Đơn hàng nhập</a> </lable>
                        <!-- Thanh phân trang -->
                        <nav aria-label="Page navigation example" id="pagination">
                            <ul class="pagination">
                              <li class="page-item">
                                <a class="page-link" href="#" aria-label="Previous">
                                  <span aria-hidden="true">&laquo;</span>
                                </a>
                              </li>
                              <li class="page-item"><a class="page-link" href="#">1</a></li>
                              <li class="page-item"><a class="page-link" href="#">2</a></li>
                              <li class="page-item"><a class="page-link" href="#">3</a></li>
                              <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                  <span aria-hidden="true">&raquo;</span>
                                  <span class="sr-only">Next</span>
                                </a>
                              </li>
                            </ul>
                        </nav>          
                    </div>
                
                <!-- Modal hiển thị đơn hàng nnhập -->
                <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="orderModalLabel" >
                                    {{ isEditMode ? 'Thông tin phiếu hàng nhập' : 'Tạo phiếu nhập hàng' }}
                                </h5>
                            
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form ng-submit="saveOrder()" enctype="multipart/form-data">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:0px;">
                                    <p><b>Mã Đơn Hàng Nhập: </b> {{selectedOrder.maDHN }}</p>
            
                                    <div>
                                        <label for="ngayNhap"><b>Ngày Nhập Hàng:</b></label>
                                        <input type="date" class="form-control" id="ngayNhap" 
                                               style="display: inline-block; width: auto; height:25px" 
                                               ng-model="selectedOrder.ngayNhap">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="tenNCC"><b>Tên Nhà Cung Cấp:</b></label>
                                    <input type="text" id="tenNCC" class="form-control" ng-model="selectedOrder.tenNCC" />
                                </div>
                                <!-- Bảng chi tiết sản phẩm -->
                                <h5 style="text-align: center; margin-top:10px;">Danh Sách Sản Phẩm</h5>
                                <table border="1">
                                    <thead>
                                        <tr>
                                            <th>Mã sản phẩm</th>
                                            <th>Tên sản phẩm</th>
                                            <th>Giá nhập</th>
                                            <th>SL</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="ct in listChiTiet">
                                            <td><input type="text" class="form-control" ng-model="ct.maSp" /></td>
                                            <td><input type="text" class="form-control" ng-model="ct.tenSp" /></td>
                                            <td><input type="text" class="form-control form-control-sm" 
                                                    ng-model="ct.giaNhap"  ng-change="ct.giaNhap = parseCurrency(ct.giaNhap)" 
                                                    ng-blur="ct.giaNhap = parseCurrency(ct.giaNhap).toLocaleString('vi-VN')"  />
                                            </td>
                                            <td><input type="number" class="form-control" ng-model="ct.soLuong" /> </td>
                                            <td>
                                                <button class="btn btn-danger" ng-click="deleteChiTiet(ct)">
                                                    <img src="images/delete.png" alt="Xóa" style="width: 15px; height:15px;"> 
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <!-- Thêm sản phẩm mới -->
                                <div class="form-inline" style="margin-top:10px;">
                                    <input type="text" class="form-control" placeholder="Mã sản phẩm" ng-model="newChiTiet.maSp" />
                                    <input type="text" class="form-control" placeholder="Tên sản phẩm" ng-model="newChiTiet.tenSp" />
                                    <input type="text" class="form-control" placeholder="Giá nhập (12345)" 
                                        ng-model="newChiTiet.giaNhap" ng-change="newChiTiet.giaNhap = parseCurrency(newChiTiet.giaNhap)" 
                                        ng-blur="newChiTiet.giaNhap = parseCurrency(newChiTiet.giaNhap).toLocaleString('vi-VN')"  />
        
                                    <input type="number" class="form-control" placeholder="Số lượng" ng-model="newChiTiet.soLuong" />
                                    <button class="btn btn-primary" style="background-color: transparent; border: none;" ng-click="addChiTiet()">✔️</button>
                                </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button ng-click="saveOrder()" type="button" class="btn btn-primary">
                                    {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            </div>
                            
                        </div>
                    </div>
                </div>
                <style>
                    table th, table td {
                        vertical-align: middle;
                    }
                    table th:nth-child(2), table td:nth-child(2) {
                        width: 38%; /* Cột Tên sản phẩm to hơn */
                    }
                    table th:nth-child(4), table td:nth-child(4) {
                        width: 11%; /* Cột Số lượng nhỏ lại */
                    }
                    .form-inline {
                    display: flex;
                    align-items: center;
                    gap: 15px; /* Khoảng cách giữa các phần tử */
                    }
                    .form-inline p {
                        margin: 0;
                    }
                    .form-inline input {
                        height: 30px; /* Điều chỉnh chiều cao */
                    }
                    .modal-header > div {
                    display: flex;
                    justify-content: space-between; /* Đẩy hai phần tử sang hai phía */
                    align-items: center; /* Căn giữa theo chiều dọc */
                    margin-bottom: 10px;
                    }
        
                    .modal-header > div p {
                        margin: 0;
                    }
        
                    .modal-header > div input {
                        height: 25px;
                        width: auto;
                        margin-left: 5px;
                    }
                </style>
        
        
                        
                </div>
                
                <!-- Nội dung Tab Thông báo -->
                <div id="notifications" class="tab-content">
                <!-- <div id="tab-notifications" ng-show="activeTab === 'notifications'" class="tab-content"> -->
                    <h2>Thông báo cửa hàng</h2>
                    <p>Danh sách thông báo.</p>
                </div>
            
                <!-- Nội dung Tab Cửa hàng -->
                <div id="store" class="tab-content">
                <!-- <div id="tab-store" ng-show="activeTab === 'store'" class="tab-content"> -->
                    <h2>Tất cả các cửa hàng</h2>
                    <p>Danh sách cửa hàng đang hoạt động.</p>
                </div>

                <!-- Nội dung Tab Người dùng -->
                <div id="user" class="tab-content" ng-controller="userCtrl" >
                    <div class="header">
                        <h3 style="display: inline-block;">Danh sách Người dùng</h3>
                        <!-- Thanh tìm kiếm -->
                        <div class="search-container" >
                            <input type="text" ng-model="searchQuery.hoten" placeholder="🔍 Tên người dùng..." class="form-control" style="width: 500px;">
                            <button ng-click="searchUsers()" class="btn btn-primary">Tìm kiếm</button>
                            <button id="loadUser" style="width:25px; height:25px; margin-top: 6px; margin-left: 20px; border: none; cursor: pointer; background: transparent;" ng-click="loadUsers()">
                                <img src="images/load.png" />
                            </button>
                        </div>
                        <button type="button" style="float:right; border:none;background-color: #FFF" data-bs-toggle="modal" data-bs-target="#userModal" ng-click="clearForm()">
                           <image class="add" src="images/addUser.png"/>
                        </button>
                    </div>    
        
                    <table class="product-table-user">
                        <thead>
                            <tr>
                                <th>PerID</th>
                                <th>Tài khoản</th>
                                <th>Họ Tên</th>
                                <th>Địa Chỉ</th>
                                <th>Role</th>
                                <th>Hành động</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="user in listUser">
                                <td>{{user.perID}}</td>
                                <td>{{user.taiKhoan}}</td>
                                <td>{{user.hoTen }}</td>
                                <td>{{user.diaChi}}</td>
                                <td>{{ user.role }}</td>
                                <td>
                                    <button class="edit-btn" ng-click="editUser(user)" data-bs-toggle="modal" data-bs-target="#userModal">Sửa</button>
                                    <button class="delete-btn" ng-click="deleteUser(user.perID)">Xóa</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
        
                    <lable style=" margin-top: 10px;"> {{ listUser.length }}<a> Người dùng</a> </lable>
                    <!-- Phân trang -->
                    <div class="pagination">
                        <button ng-repeat="page in [].constructor(totalPages()) track by $index"
                                ng-class="{'active': currentPage === $index + 1}"
                                ng-click="setPage($index + 1)">
                            {{ $index + 1 }}
                        </button>
                    </div>
        
        
                    <!-- Modal Thêm/Sửa Người Dùng -->
                    <div class="modal fade modal-lg" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="userModalLabel">
                                        {{ isEditMode ? 'Cập nhật Người Dùng' : 'Thêm Người Dùng' }}
                                    </h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form ng-submit="saveUser()" enctype="multipart/form-data">
                                        <div class="row mb-2">
                                            <div class="col-md-6">
                                                <label for="taikhoan">Email hoặc Số điện thoại:</label>
                                                <input ng-model="taikhoan" type="text" id="taikhoan" class="form-control" required>
                                            </div>
                                            <div class="col-md-6 position-relative ">
                                                <label for="matkhau">Mật khẩu:</label>
                                                <input ng-model="matkhau" type="password" id="matkhau"  class="form-control pe-3" placeholder="" required>
                                                <button type="button" id="toggle-password" class="btn btn-sm position-absolute" 
                                                    style="top: 68%; right: 10px; transform: translateY(-50%); border: none; background: none;">
                                                    <img id="eye-icon" src="images/eye.png" alt="eye" style="width: 20px; height: 20px;">
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-md-6">
                                                <label for="hoten">Họ tên:</label>
                                                <input ng-model="hoten" type="text" id="hoten" class="form-control">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="ngaysinh">Ngày sinh:</label>
                                                <input ng-model="ngaysinh" type="date" id="ngaysinh" class="form-control">
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-md-6">
                                                <label for="gioitinh">Giới tính:</label>
                                                <select ng-model="gioitinh" id="gioitinh" class="form-control">
                                                    <option value="Nam">Nam</option>
                                                    <option value="Nữ">Nữ</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="diachi">Địa chỉ:</label>
                                                <input ng-model="diachi" type="text" id="diachi" class="form-control">
                                            </div>
                                        </div>
                                        <div >
                                            <label for="role">Role:</label>
                                            <select class="role" ng-model="role" id="role" ng-options="role for role in ['Admin', 'Khách hàng']">
                                                <option value="user">Khách hàng</option>
                                                <option value="admin">Admin</option>
                                            </select>
                                        </div>
                                    </form> 
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                    <button ng-click="saveUser()" type="button" class="btn btn-primary">
                                        {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
                                    </button>
                                </div>
                            </div>
                        </div>           
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
